const { src, series } = require('gulp');
const del = require('del');
const tap = require('gulp-tap');
const fse = require('fs-extra');

let memory = {};
memory.nameList = 
`/* This file generated by gulp */
module.exports = [`;

function deleteMaterialIconList(cb) {
  return del('./materialIconList.js');
}

function loadMaterialIconList() {
  let options = {
    ignore: [
      './node_modules/@material-ui/icons/index.js',
      './node_modules/@material-ui/icons/*Outlined.js',
      './node_modules/@material-ui/icons/*TwoTone.js',
      './node_modules/@material-ui/icons/*Rounded.js',
      './node_modules/@material-ui/icons/*Sharp.js',
    ],
    read: false,
  };
  return src('./node_modules/@material-ui/icons/*.js', options)
    .pipe(tap(function(file) {
      memory.nameList += "'" + file.stem + "',";
    }));
}

async function buildMaterialIconList() {
  let contents = memory.nameList + '];';
  try {
    await fse.outputFile('./materialIconList.js', contents);
  } catch (err) {
    console.error(err);
  }
}

exports.buildMaterialIconList = series(
  deleteMaterialIconList,
  loadMaterialIconList,
  buildMaterialIconList
);