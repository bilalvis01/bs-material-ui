const { src, series } = require('gulp');
const del = require('delete');
const tap = require('gulp-tap');
const fse = require('fs-extra');

let memory = {};
memory.nameList = 
`/* This file generated by gulp */
module.exports = [`;

function deleteMuiIconsNames(cb) {
  del('./nameList.js', cb);
}

function loadMuiIcons() {
  return src('./node_modules/@material-ui/icons/*.js')
    .pipe(tap(function(file) {
      if (file.stem !== 'index') {
        memory.nameList += "'" + file.stem + "',";
      }
    }));
}

async function buildNameList() {
  try {
    let contents = memory.nameList + '];';
    await fse.outputFile('./nameList.js', contents);
  } catch (err) {
    console.error(err);
  }
}

exports.buildNameList = series(
  deleteMuiIconsNames,
  loadMuiIcons,
  buildNameList
);